---
import { socials as defaultSocials, type Social } from '../data/socials';
import SocialIcon from './icons/SocialIcon.astro';
interface Props { email?: string; socials?: Social[] }
const { email = "jozehernandez@proton.me", socials: socialsProp } = Astro.props as Props;
const socials = socialsProp ?? defaultSocials;
---
<section id="contact" class="section">
  <h2 class="text-lg md:text-xl lg:text-2xl font-bold text-(--muted) mb-3">
    <span class="hero-name glitch glitch-anim text-(--accent-pink)" data-text="#contacto">#contacto</span>
  </h2>
  <div class="panel overflow-hidden">
    <div class="panel-chrome">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
      <span class="ml-2 text-(--muted) text-xs">/dev/contact</span>
    </div>
    <div class="p-5 md:p-7 grid md:grid-cols-2 gap-6">
      <div>
        <h3 class="font-semibold mb-2 reveal" style="--d:0">canales</h3>
        <ul class="space-y-2 text-sm">
          <li class="reveal" style="--d:1"><span class="text-(--accent-phosphor)">$</span> mailto: <a href={`mailto:${email}`}>{email}</a></li>
          <li class="reveal" style="--d:2"><span class="text-(--accent-phosphor)">$</span> phone: <a href={`tel:+584121919735`}>+58 412-1919735</a></li>
          {socials.map((s: Social, i: number) => (
            <li class="flex items-center gap-2 reveal" style={`--d:${i + 3}`}><span class="text-(--accent-phosphor)">$</span> <a href={s.href} target="_blank" rel="noreferrer" class="inline-flex items-center gap-1"><SocialIcon name={s.name} size={16} /> {s.name}</a></li>
          ))}
        </ul>
      </div>
      <div>
        <h3 class="font-semibold mb-2 reveal" style="--d:0">mensaje rápido</h3>
        <form id="quick-msg" class="grid gap-3 text-sm">
          <div class="flex gap-2 items-start reveal" style="--d:1">
            <input
              type="email"
              name="from"
              id="fromEmail"
              inputmode="email"
              autocomplete="email"
              required
              maxlength="254"
              pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
              class="flex-1 bg-transparent border border-(--grid) rounded px-3 py-2 outline-none focus:border-(--accent-pink)"
              placeholder="tu correo" />
            <button type="submit" class="px-4 py-2 rounded border border-(--grid) hover:border-(--accent-pink) text-(--fg)">enviar</button>
          </div>
          <div class="space-y-1 reveal" style="--d:2">
            <textarea
              id="mensaje"
              rows="4"
              maxlength="800"
              style="resize:none;"
              class="w-full bg-transparent border border-(--grid) rounded px-3 py-2 outline-none focus:border-(--accent-pink)"
              placeholder="mensaje"></textarea>
            <div class="flex justify-between text-xs text-(--muted)">
              <span>Máximo 800 caracteres.</span>
              <span><span id="msg-count">0</span>/800</span>
            </div>
            <div id="msg-status" class="text-xs"></div>
          </div>
          <script>
            document.addEventListener('DOMContentLoaded', () => {
              const ta = document.getElementById('mensaje') as HTMLTextAreaElement | null;
              const count = document.getElementById('msg-count') as HTMLElement | null;
              const form = document.getElementById('quick-msg') as HTMLFormElement | null;
              const status = document.getElementById('msg-status') as HTMLElement | null;
              const fromEmail = document.getElementById('fromEmail') as HTMLInputElement | null;
              if (ta && count) {
                const update = () => { count.textContent = ta.value.length.toString(); };
                ta.addEventListener('input', update);
                update();
              }
              if (form && ta && status) {
                form.addEventListener('submit', (e) => {
                  e.preventDefault();
                  if (!fromEmail?.reportValidity()) return;
                  if (!ta || ta.value.length === 0) {
                    status.textContent = 'El mensaje no puede estar vacío.';
                    status.style.color = 'var(--accent-pink)';
                    return;
                  }
                  const subject = encodeURIComponent('Contacto desde wired');
                  const body = encodeURIComponent(`De: ${fromEmail.value}\n\n${ta.value}`);
                  const mailtoUrl = `mailto:${"jozehernandez@proton.me"}?subject=${subject}&body=${body}`;
                  status.textContent = 'Abriendo tu cliente de correo…';
                  status.style.color = 'var(--accent-phosphor)';
                  setTimeout(() => { window.location.href = mailtoUrl; }, 100);
                  setTimeout(() => {
                    status.textContent = 'Si el cliente se abrió, revisa y envía el correo. ✅';
                    status.style.color = 'var(--accent-pink)';
                  }, 1200);
                });
              }
            });
          </script>
        </form>
      </div>
    </div>
  </div>
</section>
<style>
  #contact .reveal { opacity: 0; transform: translateY(12px); transition: opacity .55s ease, transform .55s cubic-bezier(.22,.61,.36,1); transition-delay: calc(var(--d, 0) * 90ms); }
  #contact .reveal.is-visible { opacity: 1; transform: none; }
  @media (prefers-reduced-motion: reduce) {
    #contact .reveal { opacity: 1; transform: none; transition: none; }
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const root = document.getElementById('contact');
    if (!root) return;
    const items = root.querySelectorAll('.reveal');
    if (!('IntersectionObserver' in window)) {
      items.forEach(el => el.classList.add('is-visible'));
      return;
    }
    const io = new IntersectionObserver((entries, obs) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('is-visible');
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.1 });
    items.forEach(el => io.observe(el));
  });
</script>
